<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bitsy CRM - Simple CRM for Small Service Businesses</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://js.stripe.com/v3/"></script>
    <link href="https://fonts.googleapis.com/css2?family=Zodiak:wght@400;700;900&family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'DM Sans', sans-serif;
            background: #0a0a0f;
            color: #e8e8ed;
            overflow-x: hidden;
        }

        .heading-font {
            font-family: 'Zodiak', serif;
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1a1a24;
        }
        ::-webkit-scrollbar-thumb {
            background: #4a4a5e;
            border-radius: 4px;
        }

        /* Animated gradient background */
        .gradient-bg {
            background: linear-gradient(135deg, #0a0a0f 0%, #1a1a24 50%, #0f0f1a 100%);
            position: relative;
        }

        .gradient-bg::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 20% 30%, rgba(88, 86, 214, 0.15) 0%, transparent 50%),
                        radial-gradient(circle at 80% 70%, rgba(255, 103, 103, 0.1) 0%, transparent 50%);
            animation: pulse 8s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 0.8; }
        }

        .glass-card {
            background: rgba(26, 26, 36, 0.6);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(232, 232, 237, 0.1);
            border-radius: 16px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #5856d6 0%, #7b79f5 100%);
            color: white;
            padding: 14px 32px;
            border-radius: 12px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px rgba(88, 86, 214, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 30px rgba(88, 86, 214, 0.5);
        }

        .btn-secondary {
            background: rgba(232, 232, 237, 0.1);
            color: #e8e8ed;
            padding: 14px 32px;
            border-radius: 12px;
            font-weight: 600;
            border: 1px solid rgba(232, 232, 237, 0.2);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-secondary:hover {
            background: rgba(232, 232, 237, 0.15);
            border-color: rgba(232, 232, 237, 0.3);
        }

        .feature-card {
            transition: all 0.3s ease;
        }

        .feature-card:hover {
            transform: translateY(-8px);
            border-color: rgba(88, 86, 214, 0.3);
        }

        .pricing-card {
            transition: all 0.3s ease;
            position: relative;
        }

        .pricing-card:hover {
            transform: scale(1.03);
            border-color: rgba(88, 86, 214, 0.5);
        }

        .popular-badge {
            position: absolute;
            top: -12px;
            right: 20px;
            background: linear-gradient(135deg, #5856d6 0%, #7b79f5 100%);
            color: white;
            padding: 4px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .input-field {
            width: 100%;
            padding: 12px 16px;
            background: rgba(26, 26, 36, 0.8);
            border: 1px solid rgba(232, 232, 237, 0.1);
            border-radius: 8px;
            color: #e8e8ed;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .input-field:focus {
            outline: none;
            border-color: #5856d6;
            background: rgba(26, 26, 36, 1);
        }

        .input-field::placeholder {
            color: rgba(232, 232, 237, 0.4);
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(10, 10, 15, 0.8);
            backdrop-filter: blur(8px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .dashboard-sidebar {
            background: rgba(15, 15, 26, 0.95);
            border-right: 1px solid rgba(232, 232, 237, 0.1);
        }

        .nav-item {
            padding: 12px 20px;
            margin: 4px 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 12px;
            color: rgba(232, 232, 237, 0.7);
        }

        .nav-item:hover {
            background: rgba(232, 232, 237, 0.05);
            color: #e8e8ed;
        }

        .nav-item.active {
            background: rgba(88, 86, 214, 0.15);
            color: #5856d6;
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(88, 86, 214, 0.1) 0%, rgba(26, 26, 36, 0.8) 100%);
            border: 1px solid rgba(88, 86, 214, 0.2);
        }

        .table-header {
            background: rgba(15, 15, 26, 0.5);
            border-bottom: 1px solid rgba(232, 232, 237, 0.1);
        }

        .table-row {
            border-bottom: 1px solid rgba(232, 232, 237, 0.05);
            transition: background 0.2s ease;
        }

        .table-row:hover {
            background: rgba(232, 232, 237, 0.02);
        }

        .badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
        }

        .badge-success {
            background: rgba(52, 199, 89, 0.15);
            color: #34c759;
            border: 1px solid rgba(52, 199, 89, 0.3);
        }

        .badge-warning {
            background: rgba(255, 159, 10, 0.15);
            color: #ff9f0a;
            border: 1px solid rgba(255, 159, 10, 0.3);
        }

        .badge-error {
            background: rgba(255, 69, 58, 0.15);
            color: #ff453a;
            border: 1px solid rgba(255, 69, 58, 0.3);
        }

        .badge-info {
            background: rgba(88, 86, 214, 0.15);
            color: #5856d6;
            border: 1px solid rgba(88, 86, 214, 0.3);
        }

        .loading-spinner {
            border: 3px solid rgba(232, 232, 237, 0.1);
            border-top: 3px solid #5856d6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, createContext, useContext } = React;

        // Supabase Configuration
        // REPLACE THESE WITH YOUR ACTUAL SUPABASE CREDENTIALS
        const SUPABASE_URL = 'https://pzopawdefpsqrbrhzsha.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB6b3Bhd2RlZnBzcXJicmh6c2hhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg2ODQwNDIsImV4cCI6MjA4NDI2MDA0Mn0.uft6j_jtpXoIxurcMllBySgwxSFsIxPystJP26jhu_4';
        
        // Stripe Configuration
        const STRIPE_PUBLISHABLE_KEY = 'pk_test_51SqjuWRgjDoUT1PohLBlPObjMM727gRyhJuQqRaGsgMoNPrP2zP99cJG7J74z4rgvxmxo1ayr87QHncifA0Spqry00BwqTnmTK';
        const stripe = Stripe(STRIPE_PUBLISHABLE_KEY);
        
        // Stripe Price IDs - CONFIGURED WITH YOUR ACTUAL IDS
        const STRIPE_PRICES = {
            starter: 'price_1SqkTyRgjDoUT1Poue1pLCTo',
            professional: 'price_1SqkVERgjDoUT1Po8EcDsTxb'
        };

        // Stripe Payment Functions
        const createSimpleCheckout = async (plan, userEmail) => {
            try {
                const priceId = STRIPE_PRICES[plan];
                if (!priceId) {
                    alert('Invalid plan selected');
                    return;
                }
                
                const { error } = await stripe.redirectToCheckout({
                    lineItems: [{ price: priceId, quantity: 1 }],
                    mode: 'subscription',
                    successUrl: window.location.origin + '/?success=true',
                    cancelUrl: window.location.origin + '/?canceled=true',
                    customerEmail: userEmail,
                    clientReferenceId: userEmail
                });

                if (error) {
                    console.error('Stripe error:', error);
                    alert('Payment failed: ' + error.message);
                }
            } catch (err) {
                console.error('Checkout error:', err);
                alert('Failed to start checkout. Please try again.');
            }
        };

        const openCustomerPortal = async (stripeCustomerId) => {
            if (!stripeCustomerId) {
                alert('No subscription found. Please subscribe first.');
                return;
            }
            alert('Customer portal coming soon! You can manage your subscription in your Stripe dashboard.');
        };

        // Handle successful payment redirect
        const handlePaymentSuccess = () => {
            const urlParams = new URLSearchParams(window.location.search);
            const success = urlParams.get('success');
            
            if (success === 'true') {
                alert('ðŸŽ‰ Payment successful! Your subscription is now active. Refreshing...');
                window.history.replaceState({}, document.title, window.location.pathname);
                setTimeout(() => window.location.reload(), 1000);
            }
        };

        // Check for payment success on page load
        window.addEventListener('load', handlePaymentSuccess);

        // Subscription helper functions
        const isOnTrial = (organization) => {
            if (!organization) return false;
            return organization.subscription_status === 'trial';
        };

        const getTrialDaysRemaining = (organization) => {
            if (!organization || !organization.trial_ends_at) return 0;
            const now = new Date();
            const trialEnd = new Date(organization.trial_ends_at);
            const diffTime = trialEnd - now;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            return Math.max(0, diffDays);
        };

        const canAccessFeatures = (organization) => {
            if (!organization) return false;
            if (organization.subscription_status === 'active') return true;
            if (isOnTrial(organization) && getTrialDaysRemaining(organization) > 0) return true;
            return false;
        };
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // Auth Context
        const AuthContext = createContext();

        const AuthProvider = ({ children }) => {
            const [user, setUser] = useState(null);
            const [organization, setOrganization] = useState(null);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                checkUser();
                const { data: authListener } = supabase.auth.onAuthStateChange((event, session) => {
                    if (session?.user) {
                        setUser(session.user);
                        loadOrganization(session.user.id);
                    } else {
                        setUser(null);
                        setOrganization(null);
                    }
                });

                return () => {
                    authListener?.subscription?.unsubscribe();
                };
            }, []);

            const checkUser = async () => {
                const { data: { session } } = await supabase.auth.getSession();
                setUser(session?.user || null);
                if (session?.user) {
                    await loadOrganization(session.user.id);
                }
                setLoading(false);
            };

            const loadOrganization = async (userId) => {
                const { data, error } = await supabase
                    .from('organizations')
                    .select('*')
                    .eq('owner_id', userId)
                    .single();
                
                if (data) setOrganization(data);
            };

            const signUp = async (email, password, organizationName, plan) => {
                const { data, error } = await supabase.auth.signUp({
                    email,
                    password,
                    options: {
                        data: {
                            organization_name: organizationName,
                            plan: plan
                        }
                    }
                });

                if (error) throw error;

                // Create organization
                if (data.user) {
                    const { error: orgError } = await supabase
                        .from('organizations')
                        .insert({
                            owner_id: data.user.id,
                            name: organizationName,
                            plan: plan,
                            max_users: plan === 'starter' ? 5 : 10,
                            max_customers: plan === 'starter' ? 250 : 500
                        });

                    if (orgError) throw orgError;
                }

                return data;
            };

            const signIn = async (email, password) => {
                const { data, error } = await supabase.auth.signInWithPassword({
                    email,
                    password
                });
                if (error) throw error;
                return data;
            };

            const signOut = async () => {
                await supabase.auth.signOut();
                setUser(null);
                setOrganization(null);
            };

            return (
                <AuthContext.Provider value={{ user, organization, loading, signUp, signIn, signOut }}>
                    {children}
                </AuthContext.Provider>
            );
        };

        const useAuth = () => useContext(AuthContext);

        // Landing Page
        const LandingPage = () => {
            const [showAuthModal, setShowAuthModal] = useState(false);
            const [authMode, setAuthMode] = useState('signin');

            return (
                <div className="gradient-bg min-h-screen">
                    {/* Navigation */}
                    <nav className="relative z-10 px-6 py-6">
                        <div className="max-w-7xl mx-auto flex justify-between items-center">
                            <div className="heading-font text-3xl font-bold text-white">
                                Bitsy<span className="text-[#5856d6]">CRM</span>
                            </div>
                            <div className="flex gap-4">
                                <button 
                                    onClick={() => { setAuthMode('signin'); setShowAuthModal(true); }}
                                    className="btn-secondary"
                                >
                                    Sign In
                                </button>
                                <button 
                                    onClick={() => { setAuthMode('signup'); setShowAuthModal(true); }}
                                    className="btn-primary"
                                >
                                    Get Started
                                </button>
                            </div>
                        </div>
                    </nav>

                    {/* Hero Section */}
                    <section className="relative z-10 px-6 py-20">
                        <div className="max-w-6xl mx-auto text-center">
                            <h1 className="heading-font text-6xl md:text-7xl font-black mb-6 leading-tight">
                                Small Business.<br/>
                                <span className="text-[#5856d6]">Big Results.</span>
                            </h1>
                            <p className="text-xl text-gray-400 mb-12 max-w-2xl mx-auto">
                                The affordable CRM designed specifically for service businesses with under 50 employees. 
                                Manage customers, track jobs, and grow your businessâ€”without the enterprise price tag.
                            </p>
                            <button 
                                onClick={() => { setAuthMode('signup'); setShowAuthModal(true); }}
                                className="btn-primary text-lg"
                            >
                                Start Free Trial
                            </button>
                            <p className="text-sm text-gray-500 mt-4">No credit card required</p>
                        </div>
                    </section>

                    {/* Features */}
                    <section className="relative z-10 px-6 py-20">
                        <div className="max-w-6xl mx-auto">
                            <h2 className="heading-font text-4xl font-bold text-center mb-16">
                                Everything You Need. Nothing You Don't.
                            </h2>
                            <div className="grid md:grid-cols-3 gap-8">
                                {[
                                    {
                                        title: 'Customer Management',
                                        description: 'Track all your clients in one place with custom fields, tags, and notes.',
                                        icon: 'ðŸ‘¥'
                                    },
                                    {
                                        title: 'Job Tracking',
                                        description: 'Monitor service jobs from start to finish with status updates and assignments.',
                                        icon: 'ðŸ“‹'
                                    },
                                    {
                                        title: 'Team Collaboration',
                                        description: 'Add your team members and assign tasks to keep everyone aligned.',
                                        icon: 'ðŸ¤'
                                    },
                                    {
                                        title: 'Customizable Fields',
                                        description: 'Adapt Bitsy to your business with custom terminology and data fields.',
                                        icon: 'âš™ï¸'
                                    },
                                    {
                                        title: 'Simple Reporting',
                                        description: 'Get insights on revenue, completed jobs, and business performance.',
                                        icon: 'ðŸ“Š'
                                    },
                                    {
                                        title: 'Multi-User Access',
                                        description: 'Secure individual logins for each team member with role-based permissions.',
                                        icon: 'ðŸ”'
                                    }
                                ].map((feature, idx) => (
                                    <div key={idx} className="glass-card p-8 feature-card">
                                        <div className="text-5xl mb-4">{feature.icon}</div>
                                        <h3 className="text-xl font-bold mb-3">{feature.title}</h3>
                                        <p className="text-gray-400">{feature.description}</p>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </section>

                    {/* Pricing */}
                    <section className="relative z-10 px-6 py-20">
                        <div className="max-w-5xl mx-auto">
                            <h2 className="heading-font text-4xl font-bold text-center mb-4">
                                Simple, Transparent Pricing
                            </h2>
                            <p className="text-center text-gray-400 mb-16">
                                Choose the plan that fits your team size
                            </p>
                            <div className="grid md:grid-cols-2 gap-8 max-w-4xl mx-auto">
                                {/* Starter Plan */}
                                <div className="glass-card p-8 pricing-card">
                                    <h3 className="heading-font text-2xl font-bold mb-2">Starter</h3>
                                    <div className="flex items-baseline mb-6">
                                        <span className="text-5xl font-bold">$29</span>
                                        <span className="text-gray-400 ml-2">/month</span>
                                    </div>
                                    <ul className="space-y-4 mb-8">
                                        <li className="flex items-center gap-3">
                                            <span className="text-green-400">âœ“</span>
                                            <span>Up to 5 users</span>
                                        </li>
                                        <li className="flex items-center gap-3">
                                            <span className="text-green-400">âœ“</span>
                                            <span>250 customers</span>
                                        </li>
                                        <li className="flex items-center gap-3">
                                            <span className="text-green-400">âœ“</span>
                                            <span>Unlimited jobs</span>
                                        </li>
                                        <li className="flex items-center gap-3">
                                            <span className="text-green-400">âœ“</span>
                                            <span>Custom fields & tags</span>
                                        </li>
                                        <li className="flex items-center gap-3">
                                            <span className="text-green-400">âœ“</span>
                                            <span>Basic reporting</span>
                                        </li>
                                    </ul>
                                    <button 
                                        onClick={() => { setAuthMode('signup'); setShowAuthModal(true); }}
                                        className="btn-secondary w-full"
                                    >
                                        Start Free Trial
                                    </button>
                                </div>

                                {/* Professional Plan */}
                                <div className="glass-card p-8 pricing-card border-2 border-[#5856d6]">
                                    <div className="popular-badge">Popular</div>
                                    <h3 className="heading-font text-2xl font-bold mb-2">Professional</h3>
                                    <div className="flex items-baseline mb-6">
                                        <span className="text-5xl font-bold">$39</span>
                                        <span className="text-gray-400 ml-2">/month</span>
                                    </div>
                                    <ul className="space-y-4 mb-8">
                                        <li className="flex items-center gap-3">
                                            <span className="text-green-400">âœ“</span>
                                            <span>Up to 10 users</span>
                                        </li>
                                        <li className="flex items-center gap-3">
                                            <span className="text-green-400">âœ“</span>
                                            <span>500 customers</span>
                                        </li>
                                        <li className="flex items-center gap-3">
                                            <span className="text-green-400">âœ“</span>
                                            <span>Unlimited jobs</span>
                                        </li>
                                        <li className="flex items-center gap-3">
                                            <span className="text-green-400">âœ“</span>
                                            <span>Custom fields & tags</span>
                                        </li>
                                        <li className="flex items-center gap-3">
                                            <span className="text-green-400">âœ“</span>
                                            <span>Advanced reporting</span>
                                        </li>
                                        <li className="flex items-center gap-3">
                                            <span className="text-green-400">âœ“</span>
                                            <span>Priority support</span>
                                        </li>
                                    </ul>
                                    <button 
                                        onClick={() => { setAuthMode('signup'); setShowAuthModal(true); }}
                                        className="btn-primary w-full"
                                    >
                                        Start Free Trial
                                    </button>
                                </div>
                            </div>
                        </div>
                    </section>

                    {/* Footer */}
                    <footer className="relative z-10 px-6 py-12 border-t border-gray-800">
                        <div className="max-w-6xl mx-auto text-center text-gray-500">
                            <p className="heading-font text-2xl font-bold mb-4">
                                Bitsy<span className="text-[#5856d6]">CRM</span>
                            </p>
                            <p>&copy; 2026 BitsyCRM. All rights reserved.</p>
                        </div>
                    </footer>

                    {/* Auth Modal */}
                    {showAuthModal && (
                        <AuthModal 
                            mode={authMode} 
                            onClose={() => setShowAuthModal(false)}
                            onSwitchMode={(mode) => setAuthMode(mode)}
                        />
                    )}
                </div>
            );
        };

        // Auth Modal Component
        const AuthModal = ({ mode, onClose, onSwitchMode }) => {
            const { signUp, signIn } = useAuth();
            const [formData, setFormData] = useState({
                email: '',
                password: '',
                organizationName: '',
                plan: 'starter'
            });
            const [error, setError] = useState('');
            const [loading, setLoading] = useState(false);

            const handleSubmit = async (e) => {
                e.preventDefault();
                setError('');
                setLoading(true);

                try {
                    if (mode === 'signup') {
                        await signUp(formData.email, formData.password, formData.organizationName, formData.plan);
                        alert('Account created! Please check your email to verify your account.');
                    } else {
                        await signIn(formData.email, formData.password);
                    }
                    onClose();
                } catch (err) {
                    setError(err.message);
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="modal-overlay" onClick={onClose}>
                    <div className="modal-content glass-card p-8 max-w-md w-full mx-4" onClick={(e) => e.stopPropagation()}>
                        <div className="flex justify-between items-center mb-6">
                            <h2 className="heading-font text-2xl font-bold">
                                {mode === 'signup' ? 'Create Account' : 'Welcome Back'}
                            </h2>
                            <button onClick={onClose} className="text-gray-400 hover:text-white text-2xl">
                                Ã—
                            </button>
                        </div>

                        <form onSubmit={handleSubmit} className="space-y-4">
                            {mode === 'signup' && (
                                <>
                                    <div>
                                        <label className="block text-sm font-medium mb-2">Business Name</label>
                                        <input
                                            type="text"
                                            className="input-field"
                                            placeholder="Acme Services Inc."
                                            value={formData.organizationName}
                                            onChange={(e) => setFormData({...formData, organizationName: e.target.value})}
                                            required
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-2">Select Plan</label>
                                        <select
                                            className="input-field"
                                            value={formData.plan}
                                            onChange={(e) => setFormData({...formData, plan: e.target.value})}
                                        >
                                            <option value="starter">Starter - $29/month (5 users, 250 customers)</option>
                                            <option value="professional">Professional - $39/month (10 users, 500 customers)</option>
                                        </select>
                                    </div>
                                </>
                            )}
                            
                            <div>
                                <label className="block text-sm font-medium mb-2">Email</label>
                                <input
                                    type="email"
                                    className="input-field"
                                    placeholder="you@company.com"
                                    value={formData.email}
                                    onChange={(e) => setFormData({...formData, email: e.target.value})}
                                    required
                                />
                            </div>

                            <div>
                                <label className="block text-sm font-medium mb-2">Password</label>
                                <input
                                    type="password"
                                    className="input-field"
                                    placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
                                    value={formData.password}
                                    onChange={(e) => setFormData({...formData, password: e.target.value})}
                                    required
                                />
                            </div>

                            {error && (
                                <div className="bg-red-500/10 border border-red-500/30 text-red-400 px-4 py-3 rounded-lg">
                                    {error}
                                </div>
                            )}

                            <button 
                                type="submit" 
                                className="btn-primary w-full"
                                disabled={loading}
                            >
                                {loading ? 'Processing...' : (mode === 'signup' ? 'Create Account' : 'Sign In')}
                            </button>
                        </form>

                        <div className="mt-6 text-center text-sm text-gray-400">
                            {mode === 'signup' ? (
                                <>
                                    Already have an account?{' '}
                                    <button onClick={() => onSwitchMode('signin')} className="text-[#5856d6] hover:underline">
                                        Sign In
                                    </button>
                                </>
                            ) : (
                                <>
                                    Don't have an account?{' '}
                                    <button onClick={() => onSwitchMode('signup')} className="text-[#5856d6] hover:underline">
                                        Sign Up
                                    </button>
                                </>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        // Dashboard Component
        const Dashboard = () => {
            const { user, organization, signOut } = useAuth();
            const [activeTab, setActiveTab] = useState('dashboard');
            const [customers, setCustomers] = useState([]);
            const [jobs, setJobs] = useState([]);
            const [teamMembers, setTeamMembers] = useState([]);
            const [stats, setStats] = useState({
                totalCustomers: 0,
                activeJobs: 0,
                completedJobs: 0,
                revenue: 0
            });

            useEffect(() => {
                if (organization) {
                    loadData();
                }
            }, [organization]);

            const loadData = async () => {
                // Load customers
                const { data: customersData } = await supabase
                    .from('customers')
                    .select('*')
                    .eq('organization_id', organization.id);
                setCustomers(customersData || []);

                // Load jobs
                const { data: jobsData } = await supabase
                    .from('jobs')
                    .select('*')
                    .eq('organization_id', organization.id);
                setJobs(jobsData || []);

                // Load team members
                const { data: teamData } = await supabase
                    .from('team_members')
                    .select('*')
                    .eq('organization_id', organization.id);
                setTeamMembers(teamData || []);

                // Calculate stats
                setStats({
                    totalCustomers: customersData?.length || 0,
                    activeJobs: jobsData?.filter(j => j.status !== 'completed').length || 0,
                    completedJobs: jobsData?.filter(j => j.status === 'completed').length || 0,
                    revenue: jobsData?.reduce((sum, j) => sum + (j.value || 0), 0) || 0
                });
            };

            const renderContent = () => {
                switch(activeTab) {
                    case 'dashboard':
                        return <DashboardHome stats={stats} />;
                    case 'customers':
                        return <CustomersView customers={customers} organization={organization} onUpdate={loadData} />;
                    case 'jobs':
                        return <JobsView jobs={jobs} customers={customers} organization={organization} onUpdate={loadData} />;
                    case 'team':
                        return <TeamView teamMembers={teamMembers} organization={organization} onUpdate={loadData} />;
                    case 'settings':
                        return <SettingsView organization={organization} onUpdate={loadData} />;
                    default:
                        return <DashboardHome stats={stats} />;
                }
            };

            return (
                <div className="flex h-screen bg-[#0a0a0f]">
                    {/* Sidebar */}
                    <div className="dashboard-sidebar w-64 flex flex-col">
                        <div className="p-6 border-b border-gray-800">
                            <div className="heading-font text-2xl font-bold">
                                Bitsy<span className="text-[#5856d6]">CRM</span>
                            </div>
                            <div className="text-sm text-gray-400 mt-2">{organization?.name}</div>
                        </div>

                        <nav className="flex-1 py-4">
                            {[
                                { id: 'dashboard', label: 'Dashboard', icon: 'ðŸ“Š' },
                                { id: 'customers', label: 'Customers', icon: 'ðŸ‘¥' },
                                { id: 'jobs', label: 'Jobs', icon: 'ðŸ“‹' },
                                { id: 'team', label: 'Team', icon: 'ðŸ¤' },
                                { id: 'settings', label: 'Settings', icon: 'âš™ï¸' }
                            ].map(item => (
                                <div
                                    key={item.id}
                                    className={`nav-item ${activeTab === item.id ? 'active' : ''}`}
                                    onClick={() => setActiveTab(item.id)}
                                >
                                    <span className="text-xl">{item.icon}</span>
                                    <span>{item.label}</span>
                                </div>
                            ))}
                        </nav>

                        <div className="p-4 border-t border-gray-800">
                            <div className="flex items-center gap-3 mb-3">
                                <div className="w-10 h-10 rounded-full bg-[#5856d6] flex items-center justify-center text-white font-bold">
                                    {user?.email?.[0].toUpperCase()}
                                </div>
                                <div className="flex-1 min-w-0">
                                    <div className="text-sm font-medium truncate">{user?.email}</div>
                                    <div className="text-xs text-gray-400 capitalize">{organization?.plan} Plan</div>
                                </div>
                            </div>
                            <button onClick={signOut} className="btn-secondary w-full text-sm py-2">
                                Sign Out
                            </button>
                        </div>
                    </div>

                    {/* Main Content */}
                    <div className="flex-1 overflow-auto">
                        <div className="p-8">
                            {renderContent()}
                        </div>
                    </div>
                </div>
            );
        };

        // Dashboard Home
        const DashboardHome = ({ stats }) => {
            return (
                <div>
                    <h1 className="heading-font text-4xl font-bold mb-8">Dashboard</h1>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <div className="glass-card p-6 stat-card">
                            <div className="text-3xl mb-2">ðŸ‘¥</div>
                            <div className="text-3xl font-bold mb-1">{stats.totalCustomers}</div>
                            <div className="text-gray-400 text-sm">Total Customers</div>
                        </div>
                        <div className="glass-card p-6 stat-card">
                            <div className="text-3xl mb-2">ðŸ“‹</div>
                            <div className="text-3xl font-bold mb-1">{stats.activeJobs}</div>
                            <div className="text-gray-400 text-sm">Active Jobs</div>
                        </div>
                        <div className="glass-card p-6 stat-card">
                            <div className="text-3xl mb-2">âœ…</div>
                            <div className="text-3xl font-bold mb-1">{stats.completedJobs}</div>
                            <div className="text-gray-400 text-sm">Completed Jobs</div>
                        </div>
                        <div className="glass-card p-6 stat-card">
                            <div className="text-3xl mb-2">ðŸ’°</div>
                            <div className="text-3xl font-bold mb-1">${stats.revenue.toLocaleString()}</div>
                            <div className="text-gray-400 text-sm">Total Revenue</div>
                        </div>
                    </div>

                    <div className="glass-card p-6">
                        <h2 className="text-xl font-bold mb-4">Welcome to Bitsy CRM</h2>
                        <p className="text-gray-400 mb-4">
                            Get started by adding your first customer or creating a job. Use the navigation on the left to explore all features.
                        </p>
                        <div className="flex gap-4">
                            <button className="btn-primary">Add Customer</button>
                            <button className="btn-secondary">Create Job</button>
                        </div>
                    </div>
                </div>
            );
        };

        // ============================================
        // CUSTOMER RECORD PAGE COMPONENT
        // ============================================
        const CustomerRecordPage = ({ customerId, onClose }) => {
            const { user } = useAuth();
            const [customer, setCustomer] = useState(null);
            const [notes, setNotes] = useState([]);
            const [transactions, setTransactions] = useState([]);
            const [jobs, setJobs] = useState([]);
            const [loading, setLoading] = useState(true);
            const [activeTab, setActiveTab] = useState('overview');
            const [showEditModal, setShowEditModal] = useState(false);
            const [newNote, setNewNote] = useState('');
            const [savingNote, setSavingNote] = useState(false);
            const [organization, setOrganization] = useState(null);

            useEffect(() => {
                loadCustomerData();
            }, [customerId]);

            const loadCustomerData = async () => {
                setLoading(true);
                try {
                    const { data: orgData } = await supabase.from('organizations').select('*').eq('owner_id', user.id).single();
                    setOrganization(orgData);

                    const { data: customerData } = await supabase.from('customers').select('*').eq('id', customerId).single();
                    setCustomer(customerData);

                    const { data: notesData } = await supabase.from('customer_notes').select('*').eq('customer_id', customerId).order('created_at', { ascending: false });
                    setNotes(notesData || []);

                    const { data: transactionsData } = await supabase.from('transactions').select('*').eq('customer_id', customerId).order('created_at', { ascending: false });
                    setTransactions(transactionsData || []);

                    const { data: jobsData } = await supabase.from('jobs').select('*').eq('customer_id', customerId).order('created_at', { ascending: false });
                    setJobs(jobsData || []);
                } catch (err) {
                    console.error('Error loading customer:', err);
                } finally {
                    setLoading(false);
                }
            };

            const handleAddNote = async () => {
                if (!newNote.trim()) return;
                setSavingNote(true);
                try {
                    const { error } = await supabase.from('customer_notes').insert({
                        organization_id: organization.id,
                        customer_id: customerId,
                        created_by: user.id,
                        note_text: newNote
                    });
                    if (error) throw error;
                    setNewNote('');
                    loadCustomerData();
                } catch (err) {
                    alert('Error: ' + err.message);
                } finally {
                    setSavingNote(false);
                }
            };

            const handleDeleteNote = async (noteId) => {
                if (!confirm('Delete this note?')) return;
                try {
                    const { error } = await supabase.from('customer_notes').delete().eq('id', noteId);
                    if (error) throw error;
                    loadCustomerData();
                } catch (err) {
                    alert('Error: ' + err.message);
                }
            };

            const calculateStats = () => {
                const totalRevenue = transactions.filter(t => t.status === 'paid' && t.transaction_type !== 'expense').reduce((sum, t) => sum + parseFloat(t.amount || 0), 0);
                const outstanding = transactions.filter(t => t.status === 'pending' && t.transaction_type === 'invoice').reduce((sum, t) => sum + parseFloat(t.amount || 0), 0);
                const completedJobs = jobs.filter(j => j.status === 'completed').length;
                const activeJobs = jobs.filter(j => j.status !== 'completed' && j.status !== 'cancelled').length;
                return { totalRevenue, outstanding, completedJobs, activeJobs };
            };

            if (loading) {
                return React.createElement('div', { className: 'min-h-screen flex items-center justify-center' },
                    React.createElement('div', { className: 'text-2xl' }, 'Loading...')
                );
            }

            if (!customer) {
                return React.createElement('div', { className: 'min-h-screen flex items-center justify-center p-6' },
                    React.createElement('div', { className: 'glass-card p-8 text-center' },
                        React.createElement('h2', { className: 'text-2xl font-bold mb-4' }, 'Customer Not Found'),
                        React.createElement('button', { onClick: onClose, className: 'btn-primary' }, 'Go Back')
                    )
                );
            }

            const stats = calculateStats();

            return (
                <div className="min-h-screen bg-[#0a0a0f] p-6">
                    <div className="max-w-7xl mx-auto">
                        <div className="flex justify-between items-start mb-8">
                            <div>
                                <button onClick={onClose} className="text-gray-400 hover:text-white mb-4 flex items-center gap-2">â† Back to Customers</button>
                                <h1 className="heading-font text-4xl font-bold mb-2">{customer.name}</h1>
                                <div className="flex gap-4 text-gray-400 text-sm">
                                    {customer.email && <span>ðŸ“§ {customer.email}</span>}
                                    {customer.phone && <span>ðŸ“ž {customer.phone}</span>}
                                </div>
                            </div>
                            <button onClick={() => setShowEditModal(true)} className="btn-primary">Edit</button>
                        </div>

                        <div className="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                            <div className="glass-card p-6">
                                <div className="text-sm text-gray-400 mb-1">Total Revenue</div>
                                <div className="text-3xl font-bold text-green-400">${stats.totalRevenue.toFixed(2)}</div>
                            </div>
                            <div className="glass-card p-6">
                                <div className="text-sm text-gray-400 mb-1">Outstanding</div>
                                <div className="text-3xl font-bold text-yellow-400">${stats.outstanding.toFixed(2)}</div>
                            </div>
                            <div className="glass-card p-6">
                                <div className="text-sm text-gray-400 mb-1">Completed Jobs</div>
                                <div className="text-3xl font-bold">{stats.completedJobs}</div>
                            </div>
                            <div className="glass-card p-6">
                                <div className="text-sm text-gray-400 mb-1">Active Jobs</div>
                                <div className="text-3xl font-bold text-blue-400">{stats.activeJobs}</div>
                            </div>
                        </div>

                        <div className="flex gap-4 mb-8">
                            <button onClick={() => setActiveTab('overview')} className={activeTab === 'overview' ? 'btn-primary' : 'btn-secondary'}>Overview</button>
                            <button onClick={() => setActiveTab('notes')} className={activeTab === 'notes' ? 'btn-primary' : 'btn-secondary'}>Notes ({notes.length})</button>
                            <button onClick={() => setActiveTab('transactions')} className={activeTab === 'transactions' ? 'btn-primary' : 'btn-secondary'}>Transactions ({transactions.length})</button>
                        </div>

                        {activeTab === 'overview' && (
                            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                <div className="glass-card p-6">
                                    <h2 className="text-xl font-bold mb-4">Details</h2>
                                    <div className="space-y-3">
                                        <div><div className="text-sm text-gray-400">Email</div><div>{customer.email || '-'}</div></div>
                                        <div><div className="text-sm text-gray-400">Phone</div><div>{customer.phone || '-'}</div></div>
                                        <div><div className="text-sm text-gray-400">Address</div><div>{customer.address || '-'}</div></div>
                                        <div><div className="text-sm text-gray-400">Since</div><div>{new Date(customer.created_at).toLocaleDateString()}</div></div>
                                    </div>
                                </div>
                                <div className="glass-card p-6">
                                    <h2 className="text-xl font-bold mb-4">Recent Notes</h2>
                                    {notes.slice(0, 3).map(note => (
                                        <div key={note.id} className="mb-3 p-3 glass-card">
                                            <div className="text-xs text-gray-400">{new Date(note.created_at).toLocaleString()}</div>
                                            <div className="text-sm mt-1">{note.note_text}</div>
                                        </div>
                                    ))}
                                    {notes.length === 0 && <div className="text-gray-400">No notes yet</div>}
                                </div>
                            </div>
                        )}

                        {activeTab === 'notes' && (
                            <div className="glass-card p-6">
                                <h2 className="text-2xl font-bold mb-6">Notes</h2>
                                <div className="mb-6">
                                    <textarea className="input-field" rows="3" placeholder="Add a note..." value={newNote} onChange={(e) => setNewNote(e.target.value)} />
                                    <button onClick={handleAddNote} disabled={savingNote} className="btn-primary mt-2">{savingNote ? 'Saving...' : 'Add Note'}</button>
                                </div>
                                <div className="space-y-4">
                                    {notes.map(note => (
                                        <div key={note.id} className="glass-card p-4">
                                            <div className="flex justify-between">
                                                <div className="flex-1">
                                                    <div className="text-sm text-gray-400 mb-2">{new Date(note.created_at).toLocaleString()}</div>
                                                    <div>{note.note_text}</div>
                                                </div>
                                                <button onClick={() => handleDeleteNote(note.id)} className="text-red-400 text-sm ml-4">Delete</button>
                                            </div>
                                        </div>
                                    ))}
                                    {notes.length === 0 && <div className="text-center text-gray-400 py-8">No notes yet</div>}
                                </div>
                            </div>
                        )}

                        {activeTab === 'transactions' && (
                            <div className="glass-card p-6">
                                <h2 className="text-2xl font-bold mb-6">Transactions</h2>
                                {transactions.length === 0 && <div className="text-center text-gray-400 py-8">No transactions yet</div>}
                                {transactions.map(t => (
                                    <div key={t.id} className="glass-card p-4 mb-3 flex justify-between">
                                        <div>
                                            <div className="font-medium capitalize">{t.transaction_type}</div>
                                            <div className="text-sm text-gray-400">{t.description || '-'}</div>
                                            <div className="text-xs text-gray-500">{new Date(t.created_at).toLocaleDateString()}</div>
                                        </div>
                                        <div className="text-right">
                                            <div className="font-bold text-lg">${parseFloat(t.amount).toFixed(2)}</div>
                                            <span className={`badge badge-${t.status === 'paid' ? 'success' : 'warning'}`}>{t.status}</span>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}

                        {showEditModal && (
                            <EditCustomerModal customer={customer} onClose={() => setShowEditModal(false)} onSuccess={() => { setShowEditModal(false); loadCustomerData(); }} />
                        )}
                    </div>
                </div>
            );
        };

        // Edit Customer Modal
        const EditCustomerModal = ({ customer, onClose, onSuccess }) => {
            const [formData, setFormData] = useState({
                name: customer.name || '',
                email: customer.email || '',
                phone: customer.phone || '',
                address: customer.address || '',
                notes: customer.notes || ''
            });
            const [loading, setLoading] = useState(false);

            const handleSubmit = async (e) => {
                e.preventDefault();
                setLoading(true);
                try {
                    const { error } = await supabase.from('customers').update(formData).eq('id', customer.id);
                    if (error) throw error;
                    alert('Customer updated!');
                    onSuccess();
                } catch (err) {
                    alert('Error: ' + err.message);
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="modal-overlay" onClick={onClose}>
                    <div className="modal-content glass-card p-8 max-w-lg w-full mx-4" onClick={(e) => e.stopPropagation()}>
                        <h2 className="heading-font text-2xl font-bold mb-6">Edit Customer</h2>
                        <form onSubmit={handleSubmit} className="space-y-4">
                            <div>
                                <label className="block text-sm font-medium mb-2">Name *</label>
                                <input type="text" className="input-field" value={formData.name} onChange={(e) => setFormData({...formData, name: e.target.value})} required />
                            </div>
                            <div>
                                <label className="block text-sm font-medium mb-2">Email</label>
                                <input type="email" className="input-field" value={formData.email} onChange={(e) => setFormData({...formData, email: e.target.value})} />
                            </div>
                            <div>
                                <label className="block text-sm font-medium mb-2">Phone</label>
                                <input type="tel" className="input-field" value={formData.phone} onChange={(e) => setFormData({...formData, phone: e.target.value})} />
                            </div>
                            <div>
                                <label className="block text-sm font-medium mb-2">Address</label>
                                <input type="text" className="input-field" value={formData.address} onChange={(e) => setFormData({...formData, address: e.target.value})} />
                            </div>
                            <div className="flex gap-4">
                                <button type="submit" className="btn-primary flex-1" disabled={loading}>{loading ? 'Saving...' : 'Save'}</button>
                                <button type="button" onClick={onClose} className="btn-secondary flex-1">Cancel</button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        };

        // Create Job Modal
        const CreateJobModal = ({ customers, organizationId, onClose, onSuccess }) => {
            const { user } = useAuth();
            const [formData, setFormData] = useState({
                customer_id: '',
                title: '',
                description: '',
                status: 'pending',
                priority: 'medium',
                value: '',
                scheduled_date: ''
            });
            const [loading, setLoading] = useState(false);

            const handleSubmit = async (e) => {
                e.preventDefault();
                setLoading(true);
                try {
                    const { error } = await supabase.from('jobs').insert({
                        organization_id: organizationId,
                        ...formData,
                        value: formData.value ? parseFloat(formData.value) : 0
                    });
                    if (error) throw error;
                    alert('Job created!');
                    onSuccess();
                } catch (err) {
                    alert('Error: ' + err.message);
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="modal-overlay" onClick={onClose}>
                    <div className="modal-content glass-card p-8 max-w-lg w-full mx-4" onClick={(e) => e.stopPropagation()}>
                        <h2 className="heading-font text-2xl font-bold mb-6">Create Job</h2>
                        <form onSubmit={handleSubmit} className="space-y-4">
                            <div>
                                <label className="block text-sm font-medium mb-2">Customer *</label>
                                <select className="input-field" value={formData.customer_id} onChange={(e) => setFormData({...formData, customer_id: e.target.value})} required>
                                    <option value="">Select customer...</option>
                                    {customers.map(c => <option key={c.id} value={c.id}>{c.name}</option>)}
                                </select>
                            </div>
                            <div>
                                <label className="block text-sm font-medium mb-2">Title *</label>
                                <input type="text" className="input-field" value={formData.title} onChange={(e) => setFormData({...formData, title: e.target.value})} required />
                            </div>
                            <div>
                                <label className="block text-sm font-medium mb-2">Description</label>
                                <textarea className="input-field" rows="3" value={formData.description} onChange={(e) => setFormData({...formData, description: e.target.value})} />
                            </div>
                            <div className="grid grid-cols-2 gap-4">
                                <div>
                                    <label className="block text-sm font-medium mb-2">Status</label>
                                    <select className="input-field" value={formData.status} onChange={(e) => setFormData({...formData, status: e.target.value})}>
                                        <option value="pending">Pending</option>
                                        <option value="in_progress">In Progress</option>
                                        <option value="completed">Completed</option>
                                    </select>
                                </div>
                                <div>
                                    <label className="block text-sm font-medium mb-2">Priority</label>
                                    <select className="input-field" value={formData.priority} onChange={(e) => setFormData({...formData, priority: e.target.value})}>
                                        <option value="low">Low</option>
                                        <option value="medium">Medium</option>
                                        <option value="high">High</option>
                                        <option value="urgent">Urgent</option>
                                    </select>
                                </div>
                            </div>
                            <div>
                                <label className="block text-sm font-medium mb-2">Value ($)</label>
                                <input type="number" step="0.01" className="input-field" value={formData.value} onChange={(e) => setFormData({...formData, value: e.target.value})} />
                            </div>
                            <div>
                                <label className="block text-sm font-medium mb-2">Scheduled Date</label>
                                <input type="date" className="input-field" value={formData.scheduled_date} onChange={(e) => setFormData({...formData, scheduled_date: e.target.value})} />
                            </div>
                            <div className="flex gap-4">
                                <button type="submit" className="btn-primary flex-1" disabled={loading}>{loading ? 'Creating...' : 'Create Job'}</button>
                                <button type="button" onClick={onClose} className="btn-secondary flex-1">Cancel</button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        };

        // Customers View
        const CustomersView = ({ customers, organization, onUpdate }) => {
            const [showAddModal, setShowAddModal] = useState(false);
            const [showRecordPage, setShowRecordPage] = useState(false);
            const [selectedCustomer, setSelectedCustomer] = useState(null);
            const [searchTerm, setSearchTerm] = useState('');

            const filteredCustomers = customers.filter(c => 
                c.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                c.email?.toLowerCase().includes(searchTerm.toLowerCase())
            );

            const canAddMore = customers.length < organization.max_customers;

            const handleCustomerClick = (customer) => {
                setSelectedCustomer(customer);
                setShowRecordPage(true);
            };

            if (showRecordPage && selectedCustomer) {
                return (
                    <CustomerRecordPage 
                        customerId={selectedCustomer.id}
                        onClose={() => {
                            setShowRecordPage(false);
                            setSelectedCustomer(null);
                            onUpdate();
                        }}
                    />
                );
            }

            return (
                <div>
                    <div className="flex justify-between items-center mb-8">
                        <h1 className="heading-font text-4xl font-bold">Customers</h1>
                        <button 
                            className="btn-primary"
                            onClick={() => canAddMore ? setShowAddModal(true) : alert(`You've reached your plan limit of ${organization.max_customers} customers`)}
                        >
                            Add Customer
                        </button>
                    </div>

                    <div className="glass-card p-6 mb-6">
                        <input
                            type="text"
                            className="input-field"
                            placeholder="Search customers..."
                            value={searchTerm}
                            onChange={(e) => setSearchTerm(e.target.value)}
                        />
                    </div>

                    <div className="glass-card overflow-hidden">
                        <table className="w-full">
                            <thead>
                                <tr className="table-header">
                                    <th className="text-left p-4">Name</th>
                                    <th className="text-left p-4">Email</th>
                                    <th className="text-left p-4">Phone</th>
                                    <th className="text-left p-4">Status</th>
                                    <th className="text-left p-4">Created</th>
                                </tr>
                            </thead>
                            <tbody>
                                {filteredCustomers.map(customer => (
                                    <tr key={customer.id} className="table-row cursor-pointer hover:bg-white/5" onClick={() => handleCustomerClick(customer)}>
                                        <td className="p-4 font-medium text-[#5856d6] hover:underline">{customer.name}</td>
                                        <td className="p-4 text-gray-400">{customer.email || '-'}</td>
                                        <td className="p-4 text-gray-400">{customer.phone || '-'}</td>
                                        <td className="p-4">
                                            <span className="badge badge-success">Active</span>
                                        </td>
                                        <td className="p-4 text-gray-400">
                                            {new Date(customer.created_at).toLocaleDateString()}
                                        </td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                        {filteredCustomers.length === 0 && (
                            <div className="p-8 text-center text-gray-400">
                                {searchTerm ? 'No customers found' : 'No customers yet. Add your first customer to get started!'}
                            </div>
                        )}
                    </div>

                    <div className="mt-4 text-sm text-gray-400">
                        {customers.length} of {organization.max_customers} customers used
                    </div>

                    {showAddModal && (
                        <AddCustomerModal 
                            organizationId={organization.id}
                            onClose={() => setShowAddModal(false)}
                            onSuccess={() => {
                                setShowAddModal(false);
                                onUpdate();
                            }}
                        />
                    )}
                </div>
            );
        };

        // Add Customer Modal
        const AddCustomerModal = ({ organizationId, onClose, onSuccess }) => {
            const [formData, setFormData] = useState({
                name: '',
                email: '',
                phone: '',
                address: '',
                notes: ''
            });
            const [loading, setLoading] = useState(false);

            const handleSubmit = async (e) => {
                e.preventDefault();
                setLoading(true);

                try {
                    const { error } = await supabase
                        .from('customers')
                        .insert({
                            ...formData,
                            organization_id: organizationId
                        });

                    if (error) throw error;
                    onSuccess();
                } catch (err) {
                    alert(err.message);
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="modal-overlay" onClick={onClose}>
                    <div className="modal-content glass-card p-8 max-w-lg w-full mx-4" onClick={(e) => e.stopPropagation()}>
                        <h2 className="heading-font text-2xl font-bold mb-6">Add New Customer</h2>
                        <form onSubmit={handleSubmit} className="space-y-4">
                            <div>
                                <label className="block text-sm font-medium mb-2">Name *</label>
                                <input
                                    type="text"
                                    className="input-field"
                                    value={formData.name}
                                    onChange={(e) => setFormData({...formData, name: e.target.value})}
                                    required
                                />
                            </div>
                            <div>
                                <label className="block text-sm font-medium mb-2">Email</label>
                                <input
                                    type="email"
                                    className="input-field"
                                    value={formData.email}
                                    onChange={(e) => setFormData({...formData, email: e.target.value})}
                                />
                            </div>
                            <div>
                                <label className="block text-sm font-medium mb-2">Phone</label>
                                <input
                                    type="tel"
                                    className="input-field"
                                    value={formData.phone}
                                    onChange={(e) => setFormData({...formData, phone: e.target.value})}
                                />
                            </div>
                            <div>
                                <label className="block text-sm font-medium mb-2">Address</label>
                                <input
                                    type="text"
                                    className="input-field"
                                    value={formData.address}
                                    onChange={(e) => setFormData({...formData, address: e.target.value})}
                                />
                            </div>
                            <div>
                                <label className="block text-sm font-medium mb-2">Notes</label>
                                <textarea
                                    className="input-field"
                                    rows="3"
                                    value={formData.notes}
                                    onChange={(e) => setFormData({...formData, notes: e.target.value})}
                                />
                            </div>
                            <div className="flex gap-4">
                                <button type="submit" className="btn-primary flex-1" disabled={loading}>
                                    {loading ? 'Adding...' : 'Add Customer'}
                                </button>
                                <button type="button" onClick={onClose} className="btn-secondary flex-1">
                                    Cancel
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        };

        // Jobs View (Simplified)
        const JobsView = ({ jobs, customers, organization, onUpdate }) => {
            const [showCreateModal, setShowCreateModal] = useState(false);
            const [filter, setFilter] = useState('all');

            const filteredJobs = jobs.filter(job => {
                if (filter === 'all') return true;
                return job.status === filter;
            });

            const getStatusBadge = (status) => {
                const badges = {
                    pending: 'badge-warning',
                    in_progress: 'badge-info',
                    completed: 'badge-success',
                    cancelled: 'badge-error'
                };
                return badges[status] || 'badge-warning';
            };

            const getPriorityBadge = (priority) => {
                const badges = {
                    low: 'badge-success',
                    medium: 'badge-info',
                    high: 'badge-warning',
                    urgent: 'badge-error'
                };
                return badges[priority] || 'badge-info';
            };

            const getCustomerName = (customerId) => {
                const customer = customers.find(c => c.id === customerId);
                return customer ? customer.name : 'Unknown';
            };

            return (
                <div>
                    <div className="flex justify-between items-center mb-8">
                        <h1 className="heading-font text-4xl font-bold">Jobs</h1>
                        <button onClick={() => setShowCreateModal(true)} className="btn-primary">Create Job</button>
                    </div>

                    <div className="flex gap-4 mb-6">
                        <button onClick={() => setFilter('all')} className={filter === 'all' ? 'btn-primary' : 'btn-secondary'}>All</button>
                        <button onClick={() => setFilter('pending')} className={filter === 'pending' ? 'btn-primary' : 'btn-secondary'}>Pending</button>
                        <button onClick={() => setFilter('in_progress')} className={filter === 'in_progress' ? 'btn-primary' : 'btn-secondary'}>In Progress</button>
                        <button onClick={() => setFilter('completed')} className={filter === 'completed' ? 'btn-primary' : 'btn-secondary'}>Completed</button>
                    </div>

                    <div className="space-y-4">
                        {filteredJobs.map(job => (
                            <div key={job.id} className="glass-card p-6">
                                <div className="flex justify-between items-start">
                                    <div className="flex-1">
                                        <h3 className="text-xl font-bold mb-2">{job.title}</h3>
                                        <p className="text-gray-400 mb-3">{job.description}</p>
                                        <div className="flex gap-4 text-sm">
                                            <span className="text-gray-400">Customer: <span className="text-white">{getCustomerName(job.customer_id)}</span></span>
                                            {job.scheduled_date && (
                                                <span className="text-gray-400">Scheduled: <span className="text-white">{new Date(job.scheduled_date).toLocaleDateString()}</span></span>
                                            )}
                                            {job.value > 0 && (
                                                <span className="text-gray-400">Value: <span className="text-green-400 font-bold">${parseFloat(job.value).toFixed(2)}</span></span>
                                            )}
                                        </div>
                                    </div>
                                    <div className="flex flex-col items-end gap-2">
                                        <span className={`badge ${getStatusBadge(job.status)}`}>{job.status.replace('_', ' ')}</span>
                                        <span className={`badge ${getPriorityBadge(job.priority)}`}>{job.priority}</span>
                                    </div>
                                </div>
                            </div>
                        ))}
                        {filteredJobs.length === 0 && (
                            <div className="glass-card p-12 text-center text-gray-400">
                                {filter === 'all' ? 'No jobs yet. Create your first job!' : `No ${filter.replace('_', ' ')} jobs`}
                            </div>
                        )}
                    </div>

                    {showCreateModal && (
                        <CreateJobModal 
                            customers={customers}
                            organizationId={organization.id}
                            onClose={() => setShowCreateModal(false)}
                            onSuccess={() => {
                                setShowCreateModal(false);
                                onUpdate();
                            }}
                        />
                    )}
                </div>
            );
        };

        // Team View (Simplified)
        const TeamView = ({ teamMembers, organization, onUpdate }) => {
            return (
                <div>
                    <div className="flex justify-between items-center mb-8">
                        <h1 className="heading-font text-4xl font-bold">Team</h1>
                        <button className="btn-primary">Invite Member</button>
                    </div>
                    <div className="glass-card p-8 text-center text-gray-400">
                        Team management coming soon! Invite team members and manage permissions.
                        <div className="mt-4 text-sm">
                            Your plan allows up to {organization.max_users} users
                        </div>
                    </div>
                </div>
            );
        };

        // Settings View with Billing
        const SettingsView = ({ organization, onUpdate }) => {
            const [activeSettingsTab, setActiveSettingsTab] = useState('general');
            
            const getSubscriptionStatus = () => {
                if (organization.subscription_status === 'active') {
                    return { label: 'Active', class: 'badge-success' };
                } else if (organization.subscription_status === 'trial') {
                    return { label: 'Trial', class: 'badge-info' };
                } else if (organization.subscription_status === 'cancelled') {
                    return { label: 'Cancelled', class: 'badge-error' };
                } else {
                    return { label: 'Inactive', class: 'badge-warning' };
                }
            };
            
            const handleUpgrade = (plan) => {
                const { user } = useAuth();
                if (!user || !user.email) {
                    alert('Please log in to subscribe');
                    return;
                }
                createSimpleCheckout(plan, user.email);
            };
            
            return (
                <div>
                    <h1 className="heading-font text-4xl font-bold mb-8">Settings</h1>
                    
                    <div className="flex gap-4 mb-8">
                        <button
                            onClick={() => setActiveSettingsTab('general')}
                            className={activeSettingsTab === 'general' ? 'btn-primary' : 'btn-secondary'}
                        >
                            General
                        </button>
                        <button
                            onClick={() => setActiveSettingsTab('billing')}
                            className={activeSettingsTab === 'billing' ? 'btn-primary' : 'btn-secondary'}
                        >
                            Billing
                        </button>
                    </div>
                    
                    {activeSettingsTab === 'general' && (
                        <div className="glass-card p-8">
                            <h2 className="text-xl font-bold mb-6">Organization</h2>
                            <div className="space-y-4">
                                <div>
                                    <label className="block text-sm font-medium mb-2">Business Name</label>
                                    <input type="text" className="input-field" value={organization.name} disabled />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium mb-2">Current Plan</label>
                                    <div className="capitalize text-lg font-semibold text-[#5856d6]">
                                        {organization.plan} - ${organization.plan === 'starter' ? '29' : '39'}/month
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {activeSettingsTab === 'billing' && (
                        <div className="glass-card p-8">
                            <h2 className="text-xl font-bold mb-6">Billing & Subscription</h2>
                            <div className="space-y-6">
                                <div className="grid md:grid-cols-2 gap-4">
                                    <div>
                                        <div className="text-sm text-gray-400 mb-1">Plan</div>
                                        <div className="text-2xl font-bold capitalize">{organization.plan}</div>
                                    </div>
                                    <div>
                                        <div className="text-sm text-gray-400 mb-1">Status</div>
                                        <span className="badge badge-info">
                                            {organization.subscription_status || 'Trial'}
                                        </span>
                                    </div>
                                </div>
                                <button onClick={() => handleUpgrade(organization.plan)} className="btn-primary">
                                    Manage Subscription
                                </button>
                                <div className="bg-blue-500/10 border border-blue-500/30 text-blue-400 px-4 py-3 rounded-lg text-sm">
                                    <strong>Payment Setup Required:</strong> Follow STRIPE-INTEGRATION.md to enable billing
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // Super Admin Dashboard Component
        const SuperAdminDashboard = () => {
            const { user } = useAuth();
            const [isAdmin, setIsAdmin] = useState(false);
            const [loading, setLoading] = useState(true);
            const [activeAdminTab, setActiveAdminTab] = useState('overview');
            const [organizations, setOrganizations] = useState([]);
            const [allCustomers, setAllCustomers] = useState([]);
            const [adminUsers, setAdminUsers] = useState([]);
            const [stats, setStats] = useState({
                totalOrgs: 0,
                totalCustomers: 0,
                activeSubscriptions: 0,
                trialOrgs: 0,
                mrr: 0
            });

            useEffect(() => {
                checkAdminStatus();
            }, [user]);

            const checkAdminStatus = async () => {
                if (!user) return;
                
                try {
                    const { data, error } = await supabase
                        .from('admin_users')
                        .select('*')
                        .eq('user_id', user.id)
                        .eq('is_active', true)
                        .single();

                    if (data) {
                        setIsAdmin(true);
                        loadAdminData();
                    }
                } catch (err) {
                    console.log('Not an admin user');
                } finally {
                    setLoading(false);
                }
            };

            const loadAdminData = async () => {
                const { data: orgsData } = await supabase
                    .from('organizations')
                    .select('*')
                    .order('created_at', { ascending: false });
                setOrganizations(orgsData || []);

                const { data: customersData } = await supabase
                    .from('customers')
                    .select('id, organization_id');
                setAllCustomers(customersData || []);

                const { data: adminsData } = await supabase
                    .from('admin_users')
                    .select('*')
                    .order('created_at', { ascending: false });
                setAdminUsers(adminsData || []);

                const totalOrgs = orgsData?.length || 0;
                const totalCustomers = customersData?.length || 0;
                const activeSubscriptions = orgsData?.filter(o => o.subscription_status === 'active').length || 0;
                const trialOrgs = orgsData?.filter(o => o.subscription_status === 'trial').length || 0;
                const mrr = orgsData?.filter(o => o.subscription_status === 'active')
                    .reduce((sum, org) => sum + (org.plan === 'starter' ? 29 : 39), 0) || 0;

                setStats({ totalOrgs, totalCustomers, activeSubscriptions, trialOrgs, mrr });
            };

            const deleteOrganization = async (orgId, orgName) => {
                if (!confirm(`âš ï¸ DELETE "${orgName}"?\n\nThis will permanently delete ALL data.\nType DELETE to confirm.`)) {
                    return;
                }
                const confirmation = prompt('Type DELETE to confirm:');
                if (confirmation !== 'DELETE') {
                    alert('Deletion cancelled');
                    return;
                }
                try {
                    const { error } = await supabase.from('organizations').delete().eq('id', orgId);
                    if (error) throw error;
                    alert('Organization deleted');
                    loadAdminData();
                } catch (err) {
                    alert('Error: ' + err.message);
                }
            };

            const updateSubscriptionStatus = async (orgId, newStatus) => {
                try {
                    const { error } = await supabase.from('organizations')
                        .update({ subscription_status: newStatus }).eq('id', orgId);
                    if (error) throw error;
                    alert('Status updated');
                    loadAdminData();
                } catch (err) {
                    alert('Error: ' + err.message);
                }
            };

            if (loading) {
                return (
                    <div className="min-h-screen flex items-center justify-center">
                        <div className="loading-spinner"></div>
                    </div>
                );
            }

            if (!isAdmin) {
                return (
                    <div className="min-h-screen flex items-center justify-center p-6">
                        <div className="glass-card p-8 max-w-md text-center">
                            <div className="text-6xl mb-4">ðŸ”’</div>
                            <h2 className="text-2xl font-bold mb-3">Access Denied</h2>
                            <p className="text-gray-400">You don't have admin privileges.</p>
                            <button onClick={() => window.location.hash = ''} className="btn-primary mt-6">
                                Back to Dashboard
                            </button>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-[#0a0a0f] p-6">
                    <div className="max-w-7xl mx-auto">
                        <div className="mb-8">
                            <div className="flex justify-between items-center">
                                <div>
                                    <h1 className="heading-font text-4xl font-bold mb-2">Super Admin Dashboard</h1>
                                    <p className="text-gray-400">Manage all organizations and system settings</p>
                                </div>
                                <button onClick={() => window.location.hash = ''} className="btn-secondary">
                                    â† Back to App
                                </button>
                            </div>
                        </div>

                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6 mb-8">
                            <div className="glass-card p-6 stat-card">
                                <div className="text-2xl mb-2">ðŸ¢</div>
                                <div className="text-3xl font-bold">{stats.totalOrgs}</div>
                                <div className="text-gray-400 text-sm">Organizations</div>
                            </div>
                            <div className="glass-card p-6 stat-card">
                                <div className="text-2xl mb-2">ðŸ‘¥</div>
                                <div className="text-3xl font-bold">{stats.totalCustomers}</div>
                                <div className="text-gray-400 text-sm">Total Customers</div>
                            </div>
                            <div className="glass-card p-6 stat-card">
                                <div className="text-2xl mb-2">âœ…</div>
                                <div className="text-3xl font-bold">{stats.activeSubscriptions}</div>
                                <div className="text-gray-400 text-sm">Active Subs</div>
                            </div>
                            <div className="glass-card p-6 stat-card">
                                <div className="text-2xl mb-2">ðŸ†“</div>
                                <div className="text-3xl font-bold">{stats.trialOrgs}</div>
                                <div className="text-gray-400 text-sm">Trial Accounts</div>
                            </div>
                            <div className="glass-card p-6 stat-card">
                                <div className="text-2xl mb-2">ðŸ’°</div>
                                <div className="text-3xl font-bold">${stats.mrr}</div>
                                <div className="text-gray-400 text-sm">MRR</div>
                            </div>
                        </div>

                        <div className="flex gap-4 mb-8 overflow-x-auto">
                            <button onClick={() => setActiveAdminTab('overview')}
                                className={activeAdminTab === 'overview' ? 'btn-primary' : 'btn-secondary'}>
                                Overview
                            </button>
                            <button onClick={() => setActiveAdminTab('organizations')}
                                className={activeAdminTab === 'organizations' ? 'btn-primary' : 'btn-secondary'}>
                                Organizations
                            </button>
                            <button onClick={() => setActiveAdminTab('admins')}
                                className={activeAdminTab === 'admins' ? 'btn-primary' : 'btn-secondary'}>
                                Admin Users
                            </button>
                        </div>

                        {activeAdminTab === 'overview' && (
                            <div className="glass-card p-8">
                                <h2 className="text-2xl font-bold mb-6">Recent Organizations</h2>
                                <div className="space-y-4">
                                    {organizations.slice(0, 10).map(org => (
                                        <div key={org.id} className="glass-card p-4 flex justify-between items-center">
                                            <div>
                                                <div className="font-bold">{org.name}</div>
                                                <div className="text-sm text-gray-400">
                                                    {org.plan} â€¢ {org.subscription_status} â€¢ 
                                                    {new Date(org.created_at).toLocaleDateString()}
                                                </div>
                                            </div>
                                            <span className={`badge ${
                                                org.subscription_status === 'active' ? 'badge-success' :
                                                org.subscription_status === 'trial' ? 'badge-info' : 'badge-warning'
                                            }`}>
                                                {org.subscription_status}
                                            </span>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {activeAdminTab === 'organizations' && (
                            <div className="glass-card overflow-hidden">
                                <div className="p-6 border-b border-gray-800">
                                    <h2 className="text-2xl font-bold">All Organizations</h2>
                                </div>
                                <div className="overflow-x-auto">
                                    <table className="w-full">
                                        <thead>
                                            <tr className="table-header">
                                                <th className="text-left p-4">Name</th>
                                                <th className="text-left p-4">Plan</th>
                                                <th className="text-left p-4">Status</th>
                                                <th className="text-left p-4">Customers</th>
                                                <th className="text-left p-4">Created</th>
                                                <th className="text-left p-4">Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {organizations.map(org => {
                                                const customerCount = allCustomers.filter(c => c.organization_id === org.id).length;
                                                return (
                                                    <tr key={org.id} className="table-row">
                                                        <td className="p-4 font-medium">{org.name}</td>
                                                        <td className="p-4 capitalize">{org.plan}</td>
                                                        <td className="p-4">
                                                            <span className={`badge ${
                                                                org.subscription_status === 'active' ? 'badge-success' :
                                                                org.subscription_status === 'trial' ? 'badge-info' : 'badge-warning'
                                                            }`}>
                                                                {org.subscription_status}
                                                            </span>
                                                        </td>
                                                        <td className="p-4 text-gray-400">{customerCount}</td>
                                                        <td className="p-4 text-gray-400">
                                                            {new Date(org.created_at).toLocaleDateString()}
                                                        </td>
                                                        <td className="p-4">
                                                            <div className="flex gap-2">
                                                                <button onClick={() => updateSubscriptionStatus(org.id, 'active')}
                                                                    className="text-xs px-3 py-1 rounded bg-green-500/20 text-green-400 hover:bg-green-500/30">
                                                                    Activate
                                                                </button>
                                                                <button onClick={() => deleteOrganization(org.id, org.name)}
                                                                    className="text-xs px-3 py-1 rounded bg-red-500/20 text-red-400 hover:bg-red-500/30">
                                                                    Delete
                                                                </button>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                );
                                            })}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        )}

                        {activeAdminTab === 'admins' && (
                            <div className="glass-card p-8">
                                <h2 className="text-2xl font-bold mb-6">Admin Users</h2>
                                <div className="space-y-4">
                                    {adminUsers.map(admin => (
                                        <div key={admin.id} className="glass-card p-4 flex justify-between items-center">
                                            <div>
                                                <div className="font-bold">{admin.email}</div>
                                                <div className="text-sm text-gray-400">
                                                    {admin.role} â€¢ Created {new Date(admin.created_at).toLocaleDateString()}
                                                </div>
                                            </div>
                                            <span className={`badge ${admin.is_active ? 'badge-success' : 'badge-error'}`}>
                                                {admin.is_active ? 'Active' : 'Inactive'}
                                            </span>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // Main App Component
        const App = () => {
            const { user, loading } = useAuth();
            const [isAdminRoute, setIsAdminRoute] = useState(false);

            useEffect(() => {
                const checkHash = () => {
                    setIsAdminRoute(window.location.hash === '#admin');
                };
                
                checkHash();
                window.addEventListener('hashchange', checkHash);
                
                return () => window.removeEventListener('hashchange', checkHash);
            }, []);

            if (loading) {
                return (
                    <div className="min-h-screen bg-[#0a0a0f] flex items-center justify-center">
                        <div className="loading-spinner"></div>
                    </div>
                );
            }

            if (isAdminRoute && user) {
                return <SuperAdminDashboard />;
            }

            return user ? <Dashboard /> : <LandingPage />;
        };

        // Render App
        ReactDOM.render(
            <AuthProvider>
                <App />
            </AuthProvider>,
            document.getElementById('root')
        );
    </script>
</body>
</html>
